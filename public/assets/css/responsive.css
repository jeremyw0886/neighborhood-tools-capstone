/* ── RESPONSIVE ── */

@layer components {

  /* ── Auth pages ── */

  @media (max-width: 640px) {
    .auth-page {
      padding: 1rem;
    }

    .auth-card {
      border-radius: 0.75rem;
      padding: 1.25rem;
    }

    .form-row {
      flex-direction: column;
      gap: 0;
    }

    .auth-card form > button[type="submit"] {
      min-height: 3rem;
    }
  }

  @media (max-width: 400px) {
    .auth-card {
      box-shadow: none;
      border-inline: none;
      border-radius: 0;
    }

    .auth-page {
      padding: 0.5rem 0;
    }
  }

  /* ── Standalone pages (How To, FAQs, TOS) ── */

  @media (max-width: 640px) {
    article[aria-labelledby$="-heading"] > header {
      margin-block-end: 1.5rem;
    }

    article[aria-labelledby$="-heading"] > footer {
      margin-block-start: 1.5rem;
      padding-block-start: 1rem;
    }
  }

  @media (max-width: 400px) {
    article[aria-labelledby$="-heading"] > header > h1 {
      font-size: 1.25rem;
    }

    article[aria-labelledby$="-heading"] > footer {
      flex-direction: column;
    }

    article[aria-labelledby$="-heading"] > footer button[type="submit"] {
      width: 100%;
    }
  }

  /* ── Nav — mobile layout (always applies) ── */

  @media (max-width: 700px) {
    nav {
      padding-inline: 0;
      position: relative;
    }

    nav > a:first-child {
      padding-inline-start: 3rem;
    }

    nav > a:first-child img {
      padding-block-start: .4rem;
      width: 70px;
    }

    nav > #top-links {
      background: linear-gradient(180deg,
          var(--mountain-pine-dark) 0%,
          color-mix(in srgb, var(--mountain-pine-dark) 92%, black) 100%);
      border-block-start: 1px solid rgba(255, 255, 255, 0.15);
      display: flex;
      flex-direction: column;
      gap: 0;
      grid-column: 1 / -1;
      order: 10;
      padding: 0.5rem 0;
    }

    nav > #top-links > li {
      border-block-end: 1px solid rgba(255, 255, 255, 0.06);
    }

    nav > #top-links > li:last-child {
      border-block-end: none;
    }

    nav > #top-links a {
      border-inline-start: 3px solid transparent;
      border-radius: 0;
      font-size: 0.938rem;
      min-height: 2.75rem;
      padding: 0.75rem 1rem;
      transition: background-color 0.2s, border-color 0.2s, color 0.2s;
      width: 100%;
    }

    nav > #top-links a:is(:hover, :focus-visible) {
      background: rgba(255, 255, 255, 0.08);
      border-inline-start-color: var(--mountain-gold);
      color: var(--mountain-gold-light);
    }

    nav > #top-links a[aria-current="page"] {
      background: rgba(255, 255, 255, 0.05);
      border-block-end: none;
      border-inline-start: 3px solid var(--mountain-gold);
      color: var(--mountain-gold);
    }

    nav > #user-actions {
      grid-column: 3;
      padding-inline-end: 1.25rem;
    }

    nav > #user-actions > a[href="/notifications"] {
      align-items: center;
      display: flex;
      justify-content: center;
      min-height: 2.75rem;
      min-width: 2.75rem;
    }

    body:not(:has(.home-page)) nav > a:first-child {
      padding-inline-start: 4rem;
    }

    body:not(:has(.home-page)) nav > #user-actions {
      padding-inline-end: 2.25rem;
    }

    body:not(:has(.home-page)) > header {
      position: relative;
    }
  }

  /* ── Nav — JS-enhanced hamburger (only with JS) ── */

  @media (max-width: 700px) {
    nav.js-nav > #mobile-menu-toggle {
      display: inline-flex;
      grid-column: 2;
      justify-self: center;
    }

    nav.js-nav > #top-links {
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.35);
      clip-path: inset(0 0 100% 0);
      inset-inline: 0;
      opacity: 0;
      pointer-events: none;
      position: absolute;
      top: 100%;
      transition: clip-path 0.35s ease, opacity 0.3s ease;
      z-index: 50;
    }

    nav.js-nav > #top-links.open {
      clip-path: inset(0);
      opacity: 1;
      pointer-events: auto;
    }

    nav.js-nav > #user-actions > #user-actions-toggle,
    nav.js-nav > #user-actions > #user-actions-menu,
    nav.js-nav > #user-actions > a[href="/register"] {
      display: none;
    }

    body.menu-open::after {
      background: rgba(0, 0, 0, 0.4);
      content: "";
      inset: 0;
      position: fixed;
      z-index: 40;
    }
  }

  @media (max-width: 400px) {
    nav > a:first-child img {
      width: 32px;
    }

    body:not(:has(.home-page)) nav > a:first-child {
      padding-inline-start: 2rem;
    }

    body:not(:has(.home-page)) nav > #user-actions {
      padding-inline-end: 2rem;
    }
  }

  /* ── Unified mobile menu — auth items in hamburger (JS-only) ── */

  @media (max-width: 700px) {
    nav > #top-links > [data-mobile-auth] {
      padding: 0;
    }

    nav > #top-links > li[role="separator"] {
      background: none;
      border-block-end: none;
      border-block-start: 1px solid rgba(255, 255, 255, 0.2);
      height: auto;
      margin-block: 0.25rem;
      padding: 0;
      width: auto;
    }

    nav > #top-links > [data-mobile-auth] > span {
      align-items: center;
      color: var(--mountain-gold-light);
      display: flex;
      font-size: 0.875rem;
      font-weight: 600;
      gap: 0.4rem;
      padding: 0.625rem 1rem 0.25rem;
    }

    nav > #top-links > [data-mobile-auth] > span > i {
      opacity: 0.8;
    }

    nav > #top-links > [data-mobile-auth] :is(a, button) {
      align-items: center;
      background: transparent;
      border: none;
      border-inline-start: 3px solid transparent;
      border-radius: 0;
      color: var(--mountain-cream);
      cursor: pointer;
      display: flex;
      font-size: 0.938rem;
      gap: 0.4rem;
      min-height: 2.75rem;
      padding: 0.75rem 1rem;
      text-decoration: none;
      transition: background-color 0.2s, border-color 0.2s, color 0.2s;
      width: 100%;
    }

    nav > #top-links > [data-mobile-auth] :is(a, button):is(:hover, :focus-visible) {
      background: rgba(255, 255, 255, 0.08);
      border-inline-start-color: var(--mountain-gold);
      color: var(--mountain-gold-light);
    }

    nav > #top-links > [data-mobile-auth] :is(a, button) > i {
      font-size: 0.85em;
      opacity: 0.8;
    }
  }

  /* ── Reduced motion — disable menu animation ── */

  @media (max-width: 700px) and (prefers-reduced-motion: reduce) {
    nav.js-nav > #top-links {
      transition: none;
    }

    nav.js-nav > #mobile-menu-toggle > span {
      transition: none;
    }
  }

  /* ── Modals — viewport-level responsive ── */

  @media (max-width: 640px) {
    dialog {
      border-radius: 0.75rem;
      height: 90vh;
      height: 90dvh;
      max-height: none;
      width: calc(100vw - 1rem);
    }

    dialog > header {
      padding-block: 0.625rem;
      padding-inline: 0.875rem;
    }

    dialog > div {
      padding-block: 0.875rem;
      padding-inline: 0.875rem;
    }

    dialog > footer {
      padding-block: 0.625rem;
      padding-inline: 0.875rem;
    }

    dialog details > summary {
      min-height: 2.75rem;
      padding-block: 0.625rem;
      padding-inline: 0.75rem;
    }

    dialog details > div {
      padding-inline: 0.75rem;
    }
  }

  @media (max-width: 400px) {
    dialog {
      border-radius: 0;
      height: 100%;
      max-height: 100vh;
      max-height: 100dvh;
      max-width: 100vw;
      width: 100%;
    }

    dialog > header {
      background: var(--mountain-cloud);
      padding-block-start: calc(0.625rem + env(safe-area-inset-top, 0px));
      position: sticky;
      top: 0;
      z-index: 1;
    }

    dialog > footer {
      background: var(--mountain-cloud);
      bottom: 0;
      flex-direction: column;
      padding-block-end: calc(0.625rem + env(safe-area-inset-bottom, 0px));
      position: sticky;
      z-index: 1;
    }

    dialog > footer button[type="submit"] {
      width: 100%;
    }
  }

  /* ── Browse tools page ── */

  @media (max-width: 640px) {
    main > section[aria-labelledby="browse-heading"] {
      padding-block: 1.25rem;
      padding-inline: 1rem;
    }

    main > section[aria-labelledby="browse-heading"] > header > h1 {
      font-size: 1.5rem;
    }

    main > section[aria-labelledby="browse-heading"] > div[role="list"] {
      gap: 1rem;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    }

    main > section[aria-labelledby="browse-heading"] > nav[aria-label="Pagination"] > ul > li > a > span,
    main > section[aria-labelledby="browse-heading"] > nav[aria-label="Pagination"] > ul > li > span[aria-disabled] > span {
      display: none;
    }
  }

  @media (max-width: 400px) {
    main > section[aria-labelledby="browse-heading"] {
      padding-inline: 0.75rem;
    }

    main > section[aria-labelledby="browse-heading"] > form[role="search"] > fieldset:first-of-type {
      padding-inline: 0.75rem 0.1875rem;
    }

    main > section[aria-labelledby="browse-heading"] > form[role="search"] > fieldset:first-of-type > button > span {
      display: none;
    }

    main > section[aria-labelledby="browse-heading"] > div[role="list"] {
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    }
  }

  /* ── Tool create/edit forms ── */

  @media (max-width: 640px) {
    main > section:is([aria-labelledby="create-tool-heading"], [aria-labelledby="edit-tool-heading"]) {
      padding-block: 1.25rem;
      padding-inline: 1rem;
    }

    main > section:is([aria-labelledby="create-tool-heading"], [aria-labelledby="edit-tool-heading"]) > header > h1 {
      font-size: 1.5rem;
    }

    main > section:is([aria-labelledby="create-tool-heading"], [aria-labelledby="edit-tool-heading"]) fieldset {
      padding: 1rem;
    }

    main > section:is([aria-labelledby="create-tool-heading"], [aria-labelledby="edit-tool-heading"]) form > button[type="submit"] {
      align-self: stretch;
      justify-content: center;
      width: 100%;
    }
  }

  @media (max-width: 400px) {
    main > section:is([aria-labelledby="create-tool-heading"], [aria-labelledby="edit-tool-heading"]) {
      padding-inline: 0.75rem;
    }

    main > section:is([aria-labelledby="create-tool-heading"], [aria-labelledby="edit-tool-heading"]) fieldset {
      border-radius: 0.75rem;
      padding: 0.75rem;
    }
  }

  /* ── Dashboard pages ── */

  @media (max-width: 640px) {
    main > section:is(
      [aria-labelledby="dashboard-heading"],
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) {
      padding-block: 1.25rem;
      padding-inline: 1rem;
    }

    main > section:is(
      [aria-labelledby="dashboard-heading"],
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) > header > h1 {
      font-size: 1.5rem;
    }

    /* Sub-nav scrolls horizontally on mobile */
    main > section:is(
      [aria-labelledby="dashboard-heading"],
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) > nav[aria-label="Dashboard sections"] > ul {
      gap: 0;
    }

    main > section:is(
      [aria-labelledby="dashboard-heading"],
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) > nav[aria-label="Dashboard sections"] > ul > li > a {
      font-size: 0.813rem;
      padding-inline: 0.625rem;
    }

    /* Summary cards — 2 columns on mobile */
    section[aria-labelledby="summary-heading"] > ul,
    section[aria-labelledby="admin-summary-heading"] > ul {
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    section[aria-labelledby="summary-heading"] > ul > li > article > a,
    section[aria-labelledby="admin-summary-heading"] > ul > li > article > a {
      min-height: 6.5rem;
      padding: 1rem;
    }

    /* Quick actions — stack vertically */
    section[aria-labelledby="quick-actions-heading"] > ul {
      flex-direction: column;
    }

    section[aria-labelledby="quick-actions-heading"] > ul > li > a {
      justify-content: center;
      width: 100%;
    }

    /* Tables — horizontal scroll wrapper */
    main > section:is(
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) table {
      display: block;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    main > section:is(
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) table thead,
    main > section:is(
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) table tbody,
    main > section:is(
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) table tr {
      display: table;
      table-layout: fixed;
      width: 100%;
    }

    main > section:is(
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) table th,
    main > section:is(
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) table td {
      font-size: 0.813rem;
      padding-block: 0.625rem;
      padding-inline: 0.5rem;
    }

    /* Lender tool grid — 2 columns */
    section[aria-labelledby="listed-tools-heading"] > div[role="list"] {
      gap: 1rem;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    }
  }

  @media (max-width: 400px) {
    main > section:is(
      [aria-labelledby="dashboard-heading"],
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) {
      padding-inline: 0.75rem;
    }

    /* Summary cards — single column on very small screens */
    section[aria-labelledby="summary-heading"] > ul,
    section[aria-labelledby="admin-summary-heading"] > ul {
      grid-template-columns: 1fr;
    }

    /* Sub-nav text only (hide icons) */
    main > section:is(
      [aria-labelledby="dashboard-heading"],
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) > nav[aria-label="Dashboard sections"] > ul > li > a > i {
      display: none;
    }
  }

  /* ── Notifications page ── */

  @media (max-width: 640px) {
    main > section[aria-labelledby="notifications-heading"] {
      padding-block: 1.25rem;
      padding-inline: 1rem;
    }

    main > section[aria-labelledby="notifications-heading"] > header {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    main > section[aria-labelledby="notifications-heading"] > header > h1 {
      font-size: 1.5rem;
    }

    main > section[aria-labelledby="notifications-heading"] > header > form > button {
      width: 100%;
    }

    main > section[aria-labelledby="notifications-heading"] > ol > li > article {
      gap: 0.75rem;
      padding-inline: 0.75rem;
    }

    /* Hide prev/next text labels, keep chevron icons */
    main > section[aria-labelledby="notifications-heading"] > nav[aria-label="Pagination"] > ul > li > a > span,
    main > section[aria-labelledby="notifications-heading"] > nav[aria-label="Pagination"] > ul > li > span[aria-disabled] > span {
      display: none;
    }
  }

  @media (max-width: 400px) {
    main > section[aria-labelledby="notifications-heading"] {
      padding-inline: 0.75rem;
    }

    /* Hide type icon on very small screens */
    main > section[aria-labelledby="notifications-heading"] > ol > li > article > span:first-child {
      display: none;
    }

    /* Stack timestamp below message */
    main > section[aria-labelledby="notifications-heading"] > ol > li > article > div > footer {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.25rem;
    }
  }

  /* ── Admin pages ── */

  @media (max-width: 640px) {
    main > section:is(
      [aria-labelledby="admin-heading"],
      [aria-labelledby="admin-users-heading"],
      [aria-labelledby="admin-tools-heading"],
      [aria-labelledby="admin-disputes-heading"],
      [aria-labelledby="admin-events-heading"],
      [aria-labelledby="admin-incidents-heading"],
      [aria-labelledby="admin-reports-heading"],
      [aria-labelledby="admin-audit-heading"],
      [aria-labelledby="admin-tos-heading"]
    ) {
      padding-block: 1.25rem;
      padding-inline: 1rem;
    }

    main > section:is(
      [aria-labelledby="admin-heading"],
      [aria-labelledby="admin-users-heading"],
      [aria-labelledby="admin-tools-heading"],
      [aria-labelledby="admin-disputes-heading"],
      [aria-labelledby="admin-events-heading"],
      [aria-labelledby="admin-incidents-heading"],
      [aria-labelledby="admin-reports-heading"],
      [aria-labelledby="admin-audit-heading"],
      [aria-labelledby="admin-tos-heading"]
    ) > header > h1 {
      font-size: 1.5rem;
    }

    /* Admin sub-nav — smaller font to fit 9 links */
    nav[aria-label="Admin navigation"] > ul > li > a {
      font-size: 0.75rem;
      padding-inline: 0.5rem;
    }

    /* Quick actions — stack vertically */
    section[aria-labelledby="admin-actions-heading"] > ul {
      flex-direction: column;
    }

    section[aria-labelledby="admin-actions-heading"] > ul > li > a {
      justify-content: center;
      width: 100%;
    }
  }

  @media (max-width: 400px) {
    main > section:is(
      [aria-labelledby="admin-heading"],
      [aria-labelledby="admin-users-heading"],
      [aria-labelledby="admin-tools-heading"],
      [aria-labelledby="admin-disputes-heading"],
      [aria-labelledby="admin-events-heading"],
      [aria-labelledby="admin-incidents-heading"],
      [aria-labelledby="admin-reports-heading"],
      [aria-labelledby="admin-audit-heading"],
      [aria-labelledby="admin-tos-heading"]
    ) {
      padding-inline: 0.75rem;
    }

    /* Admin sub-nav — hide icons, text only */
    nav[aria-label="Admin navigation"] > ul > li > a > i {
      display: none;
    }
  }

  /* ── Profile page ── */

  @media (max-width: 640px) {
    main > article[aria-labelledby="profile-heading"] {
      padding-block: 1.25rem;
      padding-inline: 1rem;
    }

    /* Stack avatar + info vertically */
    main > article[aria-labelledby="profile-heading"] > header {
      align-items: center;
      flex-direction: column;
      gap: 1rem;
      text-align: center;
    }

    main > article[aria-labelledby="profile-heading"] > header > h1 {
      font-size: 1.5rem;
    }

    /* Rating cards — side by side on mobile */
    main > article[aria-labelledby="profile-heading"] > section[aria-labelledby="ratings-heading"] > div {
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    /* Tool grid — smaller cards */
    main > article[aria-labelledby="profile-heading"] > section[aria-labelledby="tools-heading"] > div[role="list"] {
      gap: 1rem;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    }

    /* Hide prev/next text labels, keep chevron icons */
    main > article[aria-labelledby="profile-heading"] > section[aria-labelledby="tools-heading"] > nav[aria-label="Pagination"] > ul > li > a > span,
    main > article[aria-labelledby="profile-heading"] > section[aria-labelledby="tools-heading"] > nav[aria-label="Pagination"] > ul > li > span[aria-disabled] > span {
      display: none;
    }
  }

  @media (max-width: 400px) {
    main > article[aria-labelledby="profile-heading"] {
      padding-inline: 0.75rem;
    }

    /* Rating cards — stack on very small screens */
    main > article[aria-labelledby="profile-heading"] > section[aria-labelledby="ratings-heading"] > div {
      grid-template-columns: 1fr;
    }

    main > article[aria-labelledby="profile-heading"] > section[aria-labelledby="tools-heading"] > div[role="list"] {
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    }
  }

}
