/* ── RESPONSIVE ── */

@layer components {

  @media (max-width: 1100px) and (min-width: 1025px) {
    body:has(.home-page) {
      max-width: 1100px;
    }

    .home-page > header {
      flex-direction: column;
      gap: 1.5rem;
    }

    .home-page > header > section {
      border-radius: 0;
      flex: none;
      width: 100%;
    }

    .home-page > header > aside {
      align-self: center;
      border-radius: 0.75rem;
      max-height: none;
      max-width: 500px;
      width: 100%;
    }

    .home-page > header > aside > section {
      justify-content: center;
    }

    .home-page > main {
      padding: 1.25rem 1rem;
    }

    .home-page > main > section:first-of-type,
    .home-page > main > section:last-of-type {
      padding: 2.5rem 1rem;
    }

    .home-page > main > section:first-of-type > div,
    .home-page > header > aside > section {
      gap: 1rem;
      padding: 0 0.5rem;
    }
  }

  /* Tablet / narrow desktop */
  @media (max-width: 1024px) {
    .home-page {
      max-width: 100%;
      width: auto;
    }

    .home-page > header {
      flex-direction: column;
      gap: 1.5rem;
      max-width: 100%;
      width: 100%;
    }

    .home-page > header > section {
      border-radius: 0 0 2rem 0;
      flex: none;
      max-height: none;
      max-width: 100%;
      width: 100%;
    }

    .home-page > header > aside {
      align-self: stretch;
      border-radius: 0.75rem;
      height: auto;
      max-height: none;
      max-width: 100%;
      width: 100%;
    }

    .home-page > header > aside > section {
      justify-content: center;
    }

    .home-page > main {
      max-width: 100%;
      padding: 1.25rem 1rem;
      width: 100%;
    }

    .home-page > main > section:first-of-type,
    .home-page > main > section:last-of-type {
      padding: 2rem 1.25rem;
    }

    .home-page > main > section:first-of-type > div,
    .home-page > header > aside > section {
      gap: 1rem;
      padding: 0 0.5rem;
    }

    .home-page > main > section:last-of-type > div {
      flex-wrap: wrap;
    }

    .neighbor-card {
      flex: 1 1 calc(50% - 0.625rem);
      min-width: 200px;
    }
  }

  @media (orientation: portrait) and (max-width: 1000px) {
    .home-page > header > section > section > div {
      flex-direction: column;
    }

    .home-page > header > section > section > div > a {
      max-width: none;
      width: 100%;
    }

    .home-page form[role="search"] {
      margin: 0.5rem 0;
      max-width: 100%;
    }
  }

  /* Large phone */
  @media (max-width: 640px) {
    .home-page > header > section > nav[data-hero] > button {
      display: inline-flex;
    }

    .home-page > header > section {
      border-radius: 0;
      gap: 1.25rem;
      padding: 1rem;
    }

    .home-page > header > section > nav[data-hero] {
      align-items: center;
      display: flex;
      gap: 0.5rem;
      position: relative;
    }

    .home-page > header > section > nav[data-hero] > a:first-child svg {
      width: 120px;
    }

    .home-page > header > section > nav[data-hero] > ul {
      background: var(--mountain-pine-dark);
      border-radius: 0 0 0.75rem 0.75rem;
      border-top: 1px solid rgba(255, 255, 255, 0.15);
      display: none;
      flex-direction: column;
      gap: 0;
      left: -1rem;
      padding: 0.5rem 1rem;
      position: absolute;
      right: -1rem;
      top: 100%;
      z-index: 50;
    }

    .home-page > header > section > nav[data-hero] > ul.open {
      display: flex;
    }

    .home-page > header > section > nav[data-hero] > ul > li {
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding: 0.75rem 0.5rem;
    }

    .home-page > header > section > nav[data-hero] > ul > li:last-child {
      border-bottom: none;
    }

    .home-page > header > section > section > h1 {
      font-size: 1.75rem;
    }

    .home-page > header > section > section > p {
      font-size: 0.95rem;
    }

    .home-page > header > section > section > div {
      align-items: center;
      flex-direction: column;
    }

    .home-page > header > section > section > div > a {
      max-width: 280px;
      width: 100%;
    }

    .home-page form[role="search"] {
      max-width: 100%;
    }

    .home-page > main {
      padding: 1rem;
    }

    .home-page > main > section:first-of-type,
    .home-page > main > section:last-of-type {
      padding: 1.5rem 0;
    }

    .home-page > main > section:first-of-type > h2,
    .home-page > main > section:last-of-type > h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }

    .home-page > header > aside > section article {
      min-width: 120px;
      width: 120px;
    }

    .home-page > main > section:first-of-type > div {
      gap: 0.75rem;
    }

    .tool-card {
      height: 230px;
      min-width: 160px;
      width: 160px;
    }

    .tool-card > figure {
      height: 130px;
    }

    .home-page > main > section:last-of-type > div {
      flex-direction: column;
    }

    .neighbor-card {
      flex: 1 1 100%;
    }

    .home-page > header > aside {
      padding: 1rem;
    }
  }

  /* ── Auth pages ── */

  @media (max-width: 640px) {
    .auth-page {
      padding: 1rem;
    }

    .auth-card {
      border-radius: 0.75rem;
      padding: 1.25rem;
    }

    .form-row {
      flex-direction: column;
      gap: 0;
    }

    .auth-card form > button[type="submit"] {
      min-height: 3rem;
    }
  }

  @media (max-width: 400px) {
    .auth-card {
      box-shadow: none;
      border-inline: none;
      border-radius: 0;
    }

    .auth-page {
      padding: 0.5rem 0;
    }
  }

  /* ── Standalone pages (How To, FAQs, TOS) ── */

  @media (max-width: 640px) {
    article[aria-labelledby$="-heading"] > header {
      margin-block-end: 1.5rem;
    }

    article[aria-labelledby$="-heading"] > footer {
      margin-block-start: 1.5rem;
      padding-block-start: 1rem;
    }
  }

  @media (max-width: 400px) {
    article[aria-labelledby$="-heading"] > header > h1 {
      font-size: 1.25rem;
    }

    article[aria-labelledby$="-heading"] > footer {
      flex-direction: column;
    }

    article[aria-labelledby$="-heading"] > footer button[type="submit"] {
      width: 100%;
    }
  }

  /* ── Standard nav — collapse to hamburger ── */

  @media (max-width: 640px) {
    nav:not([data-hero]) {
      gap: 0.375rem;
      padding-block: 0.5rem;
      padding-inline: 0.75rem;
    }

    nav:not([data-hero]) > a:first-child svg {
      width: 32px;
    }

    nav:not([data-hero]) > a:first-child span {
      font-size: 0.938rem;
    }

    nav:not([data-hero]) > #mobile-menu-toggle {
      display: inline-flex;
    }

    nav:not([data-hero]) > #top-links {
      background: var(--mountain-pine-dark);
      border-block-start: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 0 0 0.75rem 0.75rem;
      display: none;
      flex-direction: column;
      gap: 0;
      inset-inline: -0.75rem;
      margin-inline-start: 0;
      order: 10;
      padding: 0.5rem 1rem;
      position: absolute;
      top: 100%;
      width: calc(100% + 1.5rem);
      z-index: 50;
    }

    nav:not([data-hero]) > #top-links.open {
      display: flex;
    }

    nav:not([data-hero]) > #top-links > li {
      border-block-end: 1px solid rgba(255, 255, 255, 0.1);
    }

    nav:not([data-hero]) > #top-links > li:last-child {
      border-block-end: none;
    }

    nav:not([data-hero]) > #top-links a {
      border-radius: 0;
      font-size: 0.938rem;
      min-height: 2.75rem;
      padding: 0.75rem 0.5rem;
      width: 100%;
    }

    nav:not([data-hero]) > #top-links a[aria-current="page"] {
      border-block-end: none;
      border-inline-start: 3px solid var(--mountain-gold);
    }

    nav:not([data-hero]) > #hero-dropdown {
      margin-inline-start: auto;
    }

    nav:not([data-hero]) > #hero-dropdown > span {
      display: none;
    }

    /* Notification bell — 44px touch target on mobile */
    nav:not([data-hero]) > #hero-dropdown > a[href="/notifications"] {
      align-items: center;
      display: flex;
      justify-content: center;
      min-height: 2.75rem;
      min-width: 2.75rem;
    }

    /* Reposition dropdown below the header */
    body:not(:has(.home-page)) > header {
      position: relative;
    }
  }

  @media (max-width: 400px) {
    nav:not([data-hero]) > a:first-child span {
      font-size: 0.85rem;
    }

    nav:not([data-hero]) > #top-links {
      inset-inline: 0;
      width: 100%;
    }
  }

  /* ── Modals — viewport-level responsive ── */

  @media (max-width: 640px) {
    dialog {
      border-radius: 0.75rem;
      height: 90vh;
      height: 90dvh;
      max-height: none;
      width: calc(100vw - 1rem);
    }

    dialog > header {
      padding-block: 0.625rem;
      padding-inline: 0.875rem;
    }

    dialog > div {
      padding-block: 0.875rem;
      padding-inline: 0.875rem;
    }

    dialog > footer {
      padding-block: 0.625rem;
      padding-inline: 0.875rem;
    }

    dialog details > summary {
      min-height: 2.75rem;
      padding-block: 0.625rem;
      padding-inline: 0.75rem;
    }

    dialog details > div {
      padding-inline: 0.75rem;
    }
  }

  @media (max-width: 400px) {
    dialog {
      border-radius: 0;
      height: 100%;
      max-height: 100vh;
      max-height: 100dvh;
      max-width: 100vw;
      width: 100%;
    }

    dialog > header {
      background: var(--mountain-cloud);
      padding-block-start: calc(0.625rem + env(safe-area-inset-top, 0px));
      position: sticky;
      top: 0;
      z-index: 1;
    }

    dialog > footer {
      background: var(--mountain-cloud);
      bottom: 0;
      flex-direction: column;
      padding-block-end: calc(0.625rem + env(safe-area-inset-bottom, 0px));
      position: sticky;
      z-index: 1;
    }

    dialog > footer button[type="submit"] {
      width: 100%;
    }
  }

  /* Small phone */
  @media (max-width: 400px) {
    .home-page > header > section {
      border-radius: 0 0 1rem 0;
      gap: 1rem;
      padding: 0.75rem 0.75rem 1.25rem;
    }

    .home-page > header > section > nav[data-hero] > a:first-child svg {
      width: 100px;
    }

    .home-page > header > section > nav[data-hero] > ul {
      left: 0;
      right: 0;
      width: 100%;
    }

    .home-page > header > section > section > h1 {
      font-size: 1.35rem;
    }

    .home-page > header > section > section > p {
      font-size: 0.85rem;
    }

    .home-page > header > section > section > div > a {
      font-size: 0.9rem;
      padding: 0.625rem 1.25rem;
    }

    .home-page form[role="search"] {
      padding: 0.1875rem 0.1875rem 0.1875rem 0.75rem;
    }

    .home-page form[role="search"] input {
      font-size: 0.9rem;
      padding: 0.5rem;
    }

    .home-page form[role="search"] button {
      font-size: 0.8rem;
      padding: 0.5rem 0.875rem;
    }

    .home-page > header > aside > section article {
      min-width: 110px;
      width: 110px;
    }

    .tool-card {
      height: 200px;
      min-width: 140px;
      width: 140px;
    }

    .tool-card > figure {
      height: 110px;
    }

    .home-page > main > section:first-of-type > h2,
    .home-page > main > section:last-of-type > h2 {
      font-size: 1.25rem;
    }

    .neighbor-card {
      padding: 1rem 0.75rem;
    }

    body:has(.home-page) > footer {
      font-size: 0.85rem;
      padding: 1rem;
    }

    .home-page > header > aside {
      padding: 0.75rem;
    }

    .home-page > header > aside > h2 {
      font-size: 1rem;
    }

    .home-page > header > aside > section article img {
      height: 48px;
      width: 48px;
    }
  }

  /* ── Browse tools page ── */

  @media (max-width: 640px) {
    main > section[aria-labelledby="browse-heading"] {
      padding-block: 1.25rem;
      padding-inline: 1rem;
    }

    main > section[aria-labelledby="browse-heading"] > header > h1 {
      font-size: 1.5rem;
    }

    main > section[aria-labelledby="browse-heading"] > form[role="search"] > fieldset:last-of-type {
      flex-direction: column;
      gap: 0.75rem;
    }

    main > section[aria-labelledby="browse-heading"] > form[role="search"] > fieldset:last-of-type > div {
      flex-basis: 100%;
    }

    main > section[aria-labelledby="browse-heading"] > form[role="search"] > fieldset:last-of-type > button[type="submit"],
    main > section[aria-labelledby="browse-heading"] > form[role="search"] > fieldset:last-of-type > a[role="button"] {
      align-self: stretch;
      justify-content: center;
    }

    main > section[aria-labelledby="browse-heading"] > div[role="list"] {
      gap: 1rem;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    }

    main > section[aria-labelledby="browse-heading"] > nav[aria-label="Pagination"] > ul > li > a > span,
    main > section[aria-labelledby="browse-heading"] > nav[aria-label="Pagination"] > ul > li > span[aria-disabled] > span {
      display: none;
    }
  }

  @media (max-width: 400px) {
    main > section[aria-labelledby="browse-heading"] {
      padding-inline: 0.75rem;
    }

    main > section[aria-labelledby="browse-heading"] > form[role="search"] > fieldset:first-of-type {
      padding-inline: 0.75rem 0.1875rem;
    }

    main > section[aria-labelledby="browse-heading"] > form[role="search"] > fieldset:first-of-type > button > span {
      display: none;
    }

    main > section[aria-labelledby="browse-heading"] > div[role="list"] {
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    }
  }

  /* ── Dashboard pages ── */

  @media (max-width: 640px) {
    main > section:is(
      [aria-labelledby="dashboard-heading"],
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) {
      padding-block: 1.25rem;
      padding-inline: 1rem;
    }

    main > section:is(
      [aria-labelledby="dashboard-heading"],
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) > header > h1 {
      font-size: 1.5rem;
    }

    /* Sub-nav scrolls horizontally on mobile */
    main > section:is(
      [aria-labelledby="dashboard-heading"],
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) > nav[aria-label="Dashboard sections"] > ul {
      gap: 0;
    }

    main > section:is(
      [aria-labelledby="dashboard-heading"],
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) > nav[aria-label="Dashboard sections"] > ul > li > a {
      font-size: 0.813rem;
      padding-inline: 0.625rem;
    }

    /* Summary cards — 2 columns on mobile */
    section[aria-labelledby="summary-heading"] > div[role="list"],
    section[aria-labelledby="admin-summary-heading"] > div[role="list"] {
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    section[aria-labelledby="summary-heading"] > div[role="list"] > article > a,
    section[aria-labelledby="admin-summary-heading"] > div[role="list"] > article > a {
      min-height: 6.5rem;
      padding: 1rem;
    }

    /* Quick actions — stack vertically */
    section[aria-labelledby="quick-actions-heading"] > ul {
      flex-direction: column;
    }

    section[aria-labelledby="quick-actions-heading"] > ul > li > a {
      justify-content: center;
      width: 100%;
    }

    /* Tables — horizontal scroll wrapper */
    main > section:is(
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) table {
      display: block;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    main > section:is(
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) table thead,
    main > section:is(
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) table tbody,
    main > section:is(
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) table tr {
      display: table;
      table-layout: fixed;
      width: 100%;
    }

    main > section:is(
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) table th,
    main > section:is(
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) table td {
      font-size: 0.813rem;
      padding-block: 0.625rem;
      padding-inline: 0.5rem;
    }

    /* Lender tool grid — 2 columns */
    section[aria-labelledby="listed-tools-heading"] > div[role="list"] {
      gap: 1rem;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    }
  }

  @media (max-width: 400px) {
    main > section:is(
      [aria-labelledby="dashboard-heading"],
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) {
      padding-inline: 0.75rem;
    }

    /* Summary cards — single column on very small screens */
    section[aria-labelledby="summary-heading"] > div[role="list"],
    section[aria-labelledby="admin-summary-heading"] > div[role="list"] {
      grid-template-columns: 1fr;
    }

    /* Sub-nav text only (hide icons) */
    main > section:is(
      [aria-labelledby="dashboard-heading"],
      [aria-labelledby="lender-heading"],
      [aria-labelledby="borrower-heading"],
      [aria-labelledby="history-heading"]
    ) > nav[aria-label="Dashboard sections"] > ul > li > a > i {
      display: none;
    }
  }

  /* ── Notifications page ── */

  @media (max-width: 640px) {
    main > section[aria-labelledby="notifications-heading"] {
      padding-block: 1.25rem;
      padding-inline: 1rem;
    }

    main > section[aria-labelledby="notifications-heading"] > header {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    main > section[aria-labelledby="notifications-heading"] > header > h1 {
      font-size: 1.5rem;
    }

    main > section[aria-labelledby="notifications-heading"] > header > form > button {
      width: 100%;
    }

    main > section[aria-labelledby="notifications-heading"] > ol > li > article {
      gap: 0.75rem;
      padding-inline: 0.75rem;
    }

    /* Hide prev/next text labels, keep chevron icons */
    main > section[aria-labelledby="notifications-heading"] > nav[aria-label="Pagination"] > ul > li > a > span,
    main > section[aria-labelledby="notifications-heading"] > nav[aria-label="Pagination"] > ul > li > span[aria-disabled] > span {
      display: none;
    }
  }

  @media (max-width: 400px) {
    main > section[aria-labelledby="notifications-heading"] {
      padding-inline: 0.75rem;
    }

    /* Hide type icon on very small screens */
    main > section[aria-labelledby="notifications-heading"] > ol > li > article > span:first-child {
      display: none;
    }

    /* Stack timestamp below message */
    main > section[aria-labelledby="notifications-heading"] > ol > li > article > div > footer {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.25rem;
    }
  }

  /* ── Admin pages ── */

  @media (max-width: 640px) {
    main > section:is(
      [aria-labelledby="admin-heading"],
      [aria-labelledby="admin-users-heading"],
      [aria-labelledby="admin-tools-heading"],
      [aria-labelledby="admin-disputes-heading"],
      [aria-labelledby="admin-events-heading"],
      [aria-labelledby="admin-incidents-heading"],
      [aria-labelledby="admin-reports-heading"],
      [aria-labelledby="admin-audit-heading"],
      [aria-labelledby="admin-tos-heading"]
    ) {
      padding-block: 1.25rem;
      padding-inline: 1rem;
    }

    main > section:is(
      [aria-labelledby="admin-heading"],
      [aria-labelledby="admin-users-heading"],
      [aria-labelledby="admin-tools-heading"],
      [aria-labelledby="admin-disputes-heading"],
      [aria-labelledby="admin-events-heading"],
      [aria-labelledby="admin-incidents-heading"],
      [aria-labelledby="admin-reports-heading"],
      [aria-labelledby="admin-audit-heading"],
      [aria-labelledby="admin-tos-heading"]
    ) > header > h1 {
      font-size: 1.5rem;
    }

    /* Admin sub-nav — smaller font to fit 9 links */
    nav[aria-label="Admin navigation"] > ul > li > a {
      font-size: 0.75rem;
      padding-inline: 0.5rem;
    }

    /* Quick actions — stack vertically */
    section[aria-labelledby="admin-actions-heading"] > ul {
      flex-direction: column;
    }

    section[aria-labelledby="admin-actions-heading"] > ul > li > a {
      justify-content: center;
      width: 100%;
    }
  }

  @media (max-width: 400px) {
    main > section:is(
      [aria-labelledby="admin-heading"],
      [aria-labelledby="admin-users-heading"],
      [aria-labelledby="admin-tools-heading"],
      [aria-labelledby="admin-disputes-heading"],
      [aria-labelledby="admin-events-heading"],
      [aria-labelledby="admin-incidents-heading"],
      [aria-labelledby="admin-reports-heading"],
      [aria-labelledby="admin-audit-heading"],
      [aria-labelledby="admin-tos-heading"]
    ) {
      padding-inline: 0.75rem;
    }

    /* Admin sub-nav — hide icons, text only */
    nav[aria-label="Admin navigation"] > ul > li > a > i {
      display: none;
    }
  }

  /* ── Profile page ── */

  @media (max-width: 640px) {
    main > article[aria-labelledby="profile-heading"] {
      padding-block: 1.25rem;
      padding-inline: 1rem;
    }

    /* Stack avatar + info vertically */
    main > article[aria-labelledby="profile-heading"] > header {
      align-items: center;
      flex-direction: column;
      gap: 1rem;
      text-align: center;
    }

    main > article[aria-labelledby="profile-heading"] > header > h1 {
      font-size: 1.5rem;
    }

    /* Rating cards — side by side on mobile */
    main > article[aria-labelledby="profile-heading"] > section[aria-labelledby="ratings-heading"] > div {
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    /* Tool grid — smaller cards */
    main > article[aria-labelledby="profile-heading"] > section[aria-labelledby="tools-heading"] > div[role="list"] {
      gap: 1rem;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    }

    /* Hide prev/next text labels, keep chevron icons */
    main > article[aria-labelledby="profile-heading"] > section[aria-labelledby="tools-heading"] > nav[aria-label="Pagination"] > ul > li > a > span,
    main > article[aria-labelledby="profile-heading"] > section[aria-labelledby="tools-heading"] > nav[aria-label="Pagination"] > ul > li > span[aria-disabled] > span {
      display: none;
    }
  }

  @media (max-width: 400px) {
    main > article[aria-labelledby="profile-heading"] {
      padding-inline: 0.75rem;
    }

    /* Rating cards — stack on very small screens */
    main > article[aria-labelledby="profile-heading"] > section[aria-labelledby="ratings-heading"] > div {
      grid-template-columns: 1fr;
    }

    main > article[aria-labelledby="profile-heading"] > section[aria-labelledby="tools-heading"] > div[role="list"] {
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    }
  }

}
